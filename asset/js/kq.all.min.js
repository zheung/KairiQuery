!function(){for(var a,t=$(".Cards"),e=t.children(".Card"),d=[$(e)],s=0;s<3;s++)a=e.clone(),a.find(".TabHead, .TabItem").each(function(){this.dataset.tab="SKill"+(s+2)}),t.append(a),d.push($(a));window.cards=d}(),function(){window.kqd={page:0,pageMax:0,xhrUnlock:!0,dynmSearch:!0},window.kqe={toggles:$(".Toggle[data-x]"),rightNavi:$(".TabHead.RightNavi[data-tab=RightNavi]"),condName:$("#CondName"),search:$("#Search"),pagePrev:$(".PagePrev"),pageNext:$(".PageNext"),tips:$(".Tips")},window.kqs={page:$(".sPage"),pageMax:$(".sPageMax")},kqs.cards=window.cards,delete window.cards,window.kqf={retab:function(){$(".TabHead[data-tab]").unbind("click").click(function(){if(""==this.dataset.stop)return!1;var a,t,e=this.dataset.tab,d=this.dataset.page,s=this.dataset.func;return!!e&&(a=$(".TabHead[data-tab="+e+"]"),t=$(".TabItem[data-tab="+e+"]"),d&&(a.filter(":not([data-page="+d+"])").removeClass("active"),$(this).addClass("active"),t.filter(":not([data-page="+d+"])").addClass("hide"),t.filter("[data-page="+d+"]").removeClass("hide")),void(s&&(a.filter(":not([data-func="+s+"])").removeClass("active"),$(this).addClass("active"),kqf["tab"+e](s))))})},dealer:function(a){var t,e=a[0],d=kqs.cards;kqs.page.html(kqd.page=~~a[1]),kqs.pageMax.html(kqd.pageMax=~~a[2]);for(t in d)d[t].addClass("hide");for(t in e){var s=d[t],n=e[t];s[0].dataset.id=n.id,s.find(".sTitle").html("&lt;"+n.title+"&gt;"+n.name),s.find(".sCost").html(n.cost),s.find(".sStar").html(n.star||""),s.find(".sJob").html(n.job),s.find(".sAttr").html(n.attr),s.find(".sKind").html(n.kind),s.find(".sRare").html(n.rare),s.find(".sHP").html(n.hp),s.find(".sAD").html(n.ad),s.find(".sAP").html(n.ap),s.find(".sHQ").html(n.hq),s.find(".sThumb").attr("src",""),s.find(".sThumb").attr("src","https://raw.githubusercontent.com/kairiquery/kqp"+kq.conds.serv+"21/master/"+n.id+".png");var i=["awaken","normal","suport3"];for(var r in i){var l=i[r],o=n.skill[l]||[],c=0,k=s.find(".TabItem.Skill[data-page="+l+"]"),f=k.find(".TabHeader.SkillContent").empty(),p=k.find(".TabBox.SkillContent").empty();o.length||o.push({cond:"&nbsp;",content:"无"});for(var h in o){var m=o[h],g=$("<a>").addClass("TabHead").addClass("SkillContent").html(m.cond||"无").appendTo(f);g[0].dataset.tab="Skill"+t+l,g[0].dataset.page=c,"无"==g.html()&&h>0&&g.css("width","20%");var b='<span class="bfrTextRoles"></span>';for(var v in m.content)b+='<span class="TextRole">'+(m.content[v]||"无")+"</span>";b+='<span class="bfrTextRoles"></span>';var q=$("<div>").addClass("TabItem").addClass("SkillContent").html(b).appendTo(p);q[0].dataset.tab="Skill"+t+l,q[0].dataset.page=c++}f.find(":first-child").addClass("active")}var u=kq.conds.mark[0][7]?2:"通用"!=n.job?0:1;s.find(".TabHead.Skill").removeClass("primary").filter("[data-page="+i[u]+"]").addClass("primary"),s.removeClass("hide")}kqf.retab(),$(".TabHead.Skill.primary").click()},tabServ:function(a){kq.conds.serv=a,kqe.search.click()}}}(),function(){window.kq={conds:{serv:"cn",name:"",mark:[[]]},param:function(a){var t=$.extend({},kq.conds,{page:kqd.page,mark:kq.conds.mark.toString().replace(/\,/g,"~"),zero:/[1-9]/.test(kq.conds.mark.toString())?0:1});return a&&a(t),t},query:function(a,t,e,d){if(kqd.xhrUnlock)return kqd.xhrUnlock=!1,$.get({url:"kq/q",data:kq.param(a),success:t}).fail(e).always(function(){kqd.xhrUnlock=!0,d&&d()})}}}();!function(){$(window).resize(function(){$(".Main").width(document.body.clientWidth-450)}),$(".Main").width(document.body.clientWidth-450)}(),function(){kqe.toggles.click(function(e,a){var t=$(this),d=this.dataset.cond,n=this.dataset.x,c=this.dataset.y,i=this.dataset.z,o=t.hasClass("all");a&&(o=!0),"s"==n?(kqd.dynmSearch=!1,kqe.toggles.filter("[data-cond="+d+"]:not([data-x=s])").each(function(){$(this).addClass(o?"on":"off").removeClass(o?"off":"on").click()}),a||(kqd.dynmSearch=!0),t.toggleClass("all"),a||kq.query(function(e){e.page=1},kqf.dealer)):(e.ctrlKey&&!e.shiftKey?(kqd.dynmSearch=!1,kqe.toggles.filter("[data-cond="+d+"]:not([data-x="+n+"][data-y="+c+"][data-z="+i+"]):not([data-x=s])").each(function(){$(this).addClass("on").removeClass("off").click()}),a||(kqd.dynmSearch=!0),t.removeClass("on").addClass("off").click()):!e.ctrlKey&&e.shiftKey?(kqd.dynmSearch=!1,kqe.toggles.filter("[data-cond="+d+"]:not([data-x="+n+"][data-y="+c+"][data-z="+i+"]):not([data-x=s])").each(function(){$(this).addClass("off").removeClass("on").click()}),a||(kqd.dynmSearch=!0),t.removeClass("off").addClass("on").click()):(kqe.toggles.filter("[data-cond="+d+"][data-x="+n+"][data-y="+c+"][data-z="+i+"]").toggleClass("on").toggleClass("off"),d&&n&&c&&i&&(t.hasClass("on")?kq.conds.mark[n][c]|=i:kq.conds.mark[n][c]&=~i,kqd.dynmSearch&&kq.query(function(e){e.page=1},kqf.dealer))),a&&(kqd.dynmSearch=!0))})}(),function(){$(document).keydown(function(e){var a=document.activeElement;if("CondName"==a.id){if(13==e.keyCode)return e.shiftKey&&$("[data-cond][data-x=s]").trigger("click",{fourceON:!0}),kqe.search.click(),!1}else if(a==$(".sPage")[0]){if(13==e.keyCode){var t=$(e.target),d=t.html();return d>0&&d<=kqd.pageMax?kq.query(function(e){e.page=d},kqf.dealer):t.html(kqd.page),!1}}else{if(9==e.keyCode){for(var n=kqe.rightNavi.filter(".active"),c=!0;c;)n=n[e.shiftKey?"prev":"next"](),n.length||(n=kqe.rightNavi[e.shiftKey?"last":"first"]()),""!==n[0].dataset.notab&&(c=!1);return n.click(),!1}if(33==e.keyCode||74==e.keyCode)return kqe.pagePrev.click(),!1;if(34==e.keyCode||75==e.keyCode)return kqe.pageNext.click(),!1;if(35==e.keyCode||78==e.keyCode)return kq.query(function(e){e.page=kqd.pageMax},kqf.dealer),!1;if(36==e.keyCode||77==e.keyCode)return kq.query(function(e){e.page=1},kqf.dealer),!1;if(81==e.keyCode&&e.ctrlKey)return kqe.condName.focus(),!1;if(13==e.keyCode&&e.shiftKey)return $("[data-cond][data-x=s]").trigger("click",{}),kqe.search.click(),!1}})}(),function(){kqe.search.click(function(){kqd.dynmSearch=!0,kq.conds.name=kqe.condName.val(),kq.query(function(e){e.page=1},kqf.dealer)}),kqe.pagePrev.click(function(){kqd.page>1&&kq.query(function(e){e.page--},kqf.dealer)}),kqe.pageNext.click(function(){kqd.page<kqd.pageMax&&kq.query(function(e){e.page++},kqf.dealer)})}(),function(){$(".sThumb").bind("error",function(){var e=this.src;return/20\//.test(e)?void(this.src=e.replace(/21\//g,"22/")):/22\//.test(e)?void(this.src="./kq/img/no20.png"):void 0})}(),function(){kqf.retab(),$(".TabHead").filter(".active").click(),kqe.search.click()}();